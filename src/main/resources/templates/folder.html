
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>My Disk</title>

  <link rel="stylesheet" href="/css/buttons.css">

<!--  <link href="https://cdn.bootcdn.net/ajax/libs/font-awesome/5.15.3/css/all.css" rel="stylesheet">-->
<!--  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">&lt;!&ndash;  没导入这个fontaweson不会加载图标&ndash;&gt;-->

  <!--固定框架-->
  <link rel='stylesheet' href='/css/bootstrap.min.css'>

  <!--图标库-->
  <link rel='stylesheet' href='/css/material-design-iconic-font.min.css'>
  <link rel="stylesheet" href="/css/fontawesome-free-6.0.0-web/css/all.css" >

  <!--核心样式-->
  <link rel="stylesheet" href="/css/style.css">

  <!--    jquery-->
  <script src="/jquery/jquery-3.6.0.js"></script>
  <script src="/jquery/jquery.session.js"></script>
  <script src="/jquery/jquery.cookie.js"></script>
  <!--    jquery-->

  <!--    bootstrap图标-->
  <link rel="stylesheet" href="/icons-1.8.1/font/bootstrap-icons.css">
  <!--    bootstrap图标-->


</head>

<!--不再用$(document).ready(function()-->
<body class="web-body">

<div id="viewport">
  <!-- Sidebar -->
  <div id="sidebar">
    <header>
      <a href="/">我的网盘</a>
    </header>
    <ul class="nav">
      <li>
        <a href="/home">
          <i class="bi bi-file-earmark-fill" style="color: #6cdc78"></i> 所有文件
        </a>
      </li>
      <li>
        <a href="/my_share">
          <i class="bi bi-share-fill" style="color: #6cdc78"></i> 我的分享
        </a>
      </li>
      <li>
        <a href="/bin">
          <i class="bi bi-trash-fill" style="color: #6cdc78"></i> 回收站
        </a>
      </li>
      <!--      <li>-->
      <!--        <a href="#">-->
      <!--          <i class="zmdi zmdi-calendar"></i> 账户管理-->
      <!--        </a>-->
      <!--      </li>-->

    </ul>
  </div>


  <div id="content">
    <nav class="navbar navbar-default" id="topbar" style="border: 0">
      <div class="container-fluid">

<!--        &lt;!&ndash;↓↓↓↓↓↓↓↓↓↓↓↓↓  判断上一路径是否为根目录 &ndash;&gt;-->
<!--        &lt;!&ndash;      <a class="btn3 back" th:if="${session.previous_folder_is_root==1}" th:href="'/home'" style="cursor: pointer"> <i class="bi bi-arrow-left" style="font-size: 17px;color: #000000;margin-bottom: -20px"></i>   返回上一级</a>&ndash;&gt;-->
<!--        <a class="btn3 back" th:href="'/previous_path?folder_path='+${session.Current_Path}" style="cursor: pointer;margin-top: 0.6%;margin-left: -0.2%"> <i class="bi bi-arrow-left" style="font-size: 17px;color: #000000;"></i>   返回上一级</a>-->
<!--        &lt;!&ndash;↑↑↑↑↑↑↑↑↑↑↑↑↑   &ndash;&gt;-->


        <!--↓↓↓↓↓↓↓↓↓↓↓↓↓ 显示文件路径(可点击)  -->
        <div style="margin-top: 1%">
          <li style="float: left;list-style:none;">
            <a th:href="'/home'"   style="color: #9da49d;font-size: 20px;text-decoration: none">所有文件</a>
          </li>

          <ul th:each="p:${path_list}">

            <li style="float: left;list-style:none;margin-left:0.5%;margin-top: 0.3%">
              <i class="fa-solid fa-angle-right" style="color: #c5c5c5;font-size: 10px"></i>
            </li>

            <li style="float: left;list-style:none;margin-left:0.5%;">
              <a  th:text="${p.folder_name}" th:href="'/folder?folder_path='+${p.full_Path}"   style="color: #92f692;font-size: 20px;text-decoration: none"></a>
            </li>

          </ul>
        </div>
        <!--↑↑↑↑↑↑↑↑↑↑↑↑↑   -->



        <ul class="nav navbar-nav navbar-right">
          <li> <input type="checkbox" id="toggle-button">
            <!--label中的for跟input的id绑定。作用是在点击label时选中input或者取消选中input-->
            <label for="toggle-button" class="button-label">
              <span class="circle"></span>
              <span class="text on">白天</span>
              <span class="text off">黑夜</span>
            </label>
          </li>

          <li><a href="#" style="color: #ffffff" th:text="${session.name}"></a></li><!-- 右上角显示用户名-->
          <li ><a style="color: #8b0cd0;font-family: Monospace;font-weight: 900;font-size: 20px"    href="#">SVIP</a></li>
        </ul>


      </div>
    </nav>

    <div class="container-fluid" >


      <!--      <button class="myButton" id="upload-button"><i class="zmdi zmdi-download"></i>上传</button>-->
      <!--      <input  type="file" class="myButton" id="select-file" name="file" webkitdirectory>-->
      <!--            <input th:text="文件夹" type="file" class="myButton" class="select-file" name="file" webkitdirectory >-->

    </div>
    <!--    onclick="self.location=document.referrer;"     js返回前一页并刷新-->

    <table class="fileTable">
      <tr>
        <td th:width="10" style="overflow: hidden"><input type="checkbox"></td>
        <td th:width="15" class="table-td" ></td>
        <td th:width="300" class="table-td" >名称</td>
        <td th:width="100" class="table-td" >大小</td>
        <td th:width="150" class="table-td" >修改日期</td>
        <td th:width="100" class="table-td" ></td>

      </tr>

      <!--↓↓↓↓↓↓↓↓↓↓↓↓↓ 文件夹显示  -->
      <tr class="table_area" th:each="f:${folder_list}">

        <td class="table-td"><input type="checkbox" class="single_checkbox"></td>

        <td class="folder_icon"><i class="bi bi-folder-fill"></i></td>

        <!--        <td th:text="${f.file_name}" class="table-td"></td>   显示文件夹名，备选，不可点击跳转-->
        <td ><a  class="table-td" th:text="${f.file_name}" th:href="'/folder?folder_path='+${f.file_path}" style="cursor: pointer"></a></td>

        <td  class="operation_button_area">
<!--          <a th:href="'/download?fileName='+${f.file_name}" class="btn download" th:value="${f.file_name}"><i class="bi bi-download"></i></a>-->
          <button class="btn delete" id="delete"   th:onclick="move_to_recycle_bin([[${f.file_path}]],[[${f.file_name}]],[[${f.suffix}]],[[${f.file_size}]],[[${f.create_time}]]);"><i class="bi bi-trash"></i></button>
<!--          <a th:href="'/share?file_name='+${f.file_name}+'&file_path='+${f.file_path}+'&file_size='+${f.file_size}+'&create_time='+${f.create_time}+'&suffix='+${f.suffix}" class="btn arrow" th:value="${f.file_name}"><i class="bi bi-share-fill"></i></a>-->
          <!--            <td><button class="btn delete" id="delete"  th:onclick="move_to_recycle_bin([[${f.file_name}]]);"><i class="bi bi-trash"></i>回收站</button></td>-->
        </td>


        <td th:text="'-'" class="file_size_td"></td>
        <td th:text="${f.create_time}" class="table-td"></td>
        <!--        <td><a th:href="'/folder?pageNum=1&folder_name='+${f.file_name}+'&parent='+${session.current_path}" class="btn folder" >进入</a></td>-->

      </tr>
      <!--↑↑↑↑↑↑↑↑↑↑↑↑↑   -->



      <!--↓↓↓↓↓↓↓↓↓↓↓↓↓ 文件显示区域  -->
      <tr class="table_area" th:each="file:${file_list}" >

        <td class="table-td"><input type="checkbox" class="single_checkbox"></td>
        <!--        <td class="file_icon"><i class="bi bi-file-earmark-image"></i></td>-->


        <!--          用thymeleaf判断文件类型，并根据类型显示文件图标-->
        <td class="file_icon" th:if="${file.suffix!='jpg' and file.suffix!='png' and file.suffix!='jpeg' and file.suffix!='bmp' and file.suffix!='png' and file.suffix!='gif' and file.suffix!='doc' and file.suffix!='docx' and file.suffix!='folder' and file.suffix!='txt' and file.suffix!='ini' and file.suffix!='xml'
           and file.suffix!='mp3'and file.suffix!='wma'and file.suffix!='wav'and file.suffix!='ape'and file.suffix!='flac' and file.suffix!='mp4'and file.suffix!='mov'and file.suffix!='avi'and file.suffix!='flv'and file.suffix!='wmv'and file.suffix!='mpeg'and file.suffix!='mkv'
           and file.suffix!='rar'and file.suffix!='zip'and file.suffix!='tar'and file.suffix!='7z'  }">
          <i class="bi bi-file-earmark"></i>
        </td>


        <td class="file_icon"  th:if="${file.suffix=='jpg'||file.suffix=='png'||file.suffix=='jpeg'||file.suffix=='bmp'|| file.suffix=='png'||file.suffix=='gif'}"><i class="bi bi-file-earmark-image" ></i></td>

        <td class="file_icon"  th:if="${file.suffix=='doc'||file.suffix=='docx'}"><i class="bi bi-file-earmark-word"></i></td>

        <td class="file_icon"  th:if="${file.suffix=='folder'}"><i class="bi bi-folder"></i></td>

        <td class="file_icon"  th:if="${file.suffix=='txt'||file.suffix=='ini'||file.suffix=='xml' }"><i class="bi bi-file-earmark-text"></i></td>

        <td class="file_icon"  th:if="${file.suffix=='mp3'||file.suffix=='wma'||file.suffix=='wav'||file.suffix=='ape'||file.suffix=='flac' }"><i class="bi bi-file-earmark-music"></i></td>

        <td class="file_icon"  th:if="${file.suffix=='mp4'||file.suffix=='mov'||file.suffix=='avi'||file.suffix=='flv'||file.suffix=='wmv'||file.suffix=='mpeg'||file.suffix=='mkv'}"><i class="bi bi-file-earmark-play"></i></td>

        <td class="file_icon"  th:if="${file.suffix=='rar'||file.suffix=='zip'||file.suffix=='tar'||file.suffix=='7z'}"><i class="bi bi-file-earmark-zip-fill"></i></td>
        <!--             用thymeleaf判断文件类型，并根据类型显示文件图标 -->






<!--        <td th:text="${file.file_name}" class="table-td" >-->

        <!--↓↓↓↓↓↓↓↓↓↓↓↓↓ 非图片和视频时的文件名字样式 ,文件名显示 -->
        <td th:if="${file.suffix!='jpg' and file.suffix!='png' and file.suffix!='jpeg'  and file.suffix!='bmp' and file.suffix!='png' and file.suffix!='gif' and file.suffix!='mp4' and file.suffix!='mov'and file.suffix!='avi' and file.suffix!='flv' and file.suffix!='wmv' and file.suffix!='mpeg' and file.suffix!='mkv'}" th:text="${file.file_name}" class="table-td" ></td>
        <!--↑↑↑↑↑↑↑↑↑↑↑↑↑   -->


        <td th:if="${file.suffix=='mp4'||file.suffix=='mov'||file.suffix=='avi'||file.suffix=='flv'|| file.suffix=='wmv'||file.suffix=='mpeg'||file.suffix=='mkv'}" ><a style="cursor: pointer" class="image-td"  target="_blank" th:href="'/video?video_path='+${file.file_path}+'&video_name='+${file.file_name}" th:text="${file.file_name}"></a></td>

        <td th:if="${file.suffix=='jpg'||file.suffix=='png'||file.suffix=='jpeg'||file.suffix=='bmp'|| file.suffix=='png'||file.suffix=='gif'}" ><a style="cursor: pointer" class="image-td" th:onclick="view_image([[${file.file_name}]],[[${session.user_name}]]);" th:text="${file.file_name}"></a></td>







        <!--↓↓↓↓↓↓↓↓↓↓↓↓↓  操作按钮区 -->
        <td class="operation_button_area">
          <a th:href="'/download?file_path='+${file.file_path}" class="btn download" th:value="${file.file_name}"><i class="bi bi-download"></i></a>
          <button class="btn delete" id="delete"  th:onclick="move_to_recycle_bin([[${file.file_path}]],[[${file.file_name}]],[[${file.suffix}]],[[${file.file_size}]],[[${file.create_time}]]);"><i class="bi bi-trash"></i></button>
          <a th:href="'/share?file_name='+${file.file_name}+'&file_path='+${file.file_path}+'&file_size='+${file.file_size}+'&create_time='+${file.create_time}+'&suffix='+${file.suffix}" class="btn arrow" th:value="${file.file_name}"><i class="bi bi-share-fill"></i></a>
        </td>
        <!--↑↑↑↑↑↑↑↑↑↑↑↑↑   -->

        <td th:text="${file.file_size}+' kb'" class="file_size_td"></td>
        <td th:text="${file.create_time}" class="table-td"></td>

<!--        <td>-->
<!--          <a th:href="'/download?fileName='+${file.file_name}" class="btn download" th:value="${file.file_name}"><i class="bi bi-download"></i>下载</a>-->
<!--          <button class="btn delete" id="delete"  th:onclick="DeleteFile([[${file.file_name}]]);"><i class="bi bi-x-lg"></i>删除</button>-->
<!--        </td>-->
      </tr>
      <!--↑↑↑↑↑↑↑↑↑↑↑↑↑   -->




    </table>



<!--    &lt;!&ndash;    该div为分页的页数显示与操作区域&ndash;&gt;-->
<!--    <div class="Pagination">-->
<!--      &lt;!&ndash;      <span th:text="'当前为第'+${pageInfo.pageNum}+'页'"></span>&ndash;&gt;-->
<!--      &lt;!&ndash;      <span th:text="'总共'+${pageInfo.pages}+'页'"></span>&ndash;&gt;-->
<!--      &lt;!&ndash;      th:if="${pageInfo.hasPreviousPage}"&ndash;&gt;-->
<!--      <a class="btn arrow" th:href="'/home?pageNum=1'" th:if="${pageInfo.hasPreviousPage==true}">首页</a>-->

<!--      <a class="btn arrow" th:href="'/home?pageNum='+${pageInfo.prePage}" th:if="${pageInfo.hasPreviousPage==true}"><i class="fas fa-arrow-left"></i></a>&lt;!&ndash;      前一页          th:classappend="${pageInfo.hasPreviousPage==false}?'disable_click':''"&ndash;&gt;-->

<!--      <li th:each="nav:${pageInfo.navigatepageNums}" class="pagination" style="display: inline-block" >&lt;!&ndash;inline-block使li横向排列&ndash;&gt;-->
<!--        <a class="btn arrow"  th:href="'/home?pageNum='+${nav}" th:text="${nav}" th:if="${nav != pageInfo.pageNum}"></a>-->
<!--        <a id="get_cunrrent_pagenum" class="btn2 selected" th:value="10" th:href="'/home?pageNum='+${nav}" th:text="${nav}" th:if="${nav == pageInfo.pageNum}" th:classappend="${nav == pageInfo.pageNum}?'disable_click':''"></a>-->
<!--      </li>-->

<!--      <a class="btn arrow" th:href="'/home?pageNum='+${pageInfo.nextPage}" th:if="${pageInfo.hasNextPage==true}"><i class="fas fa-arrow-right"></i></a>&lt;!&ndash;      后一页           th:classappend="${pageInfo.hasNextPage==false}?'disable_click':''"&ndash;&gt;-->

<!--      <a class="btn arrow" th:href="'/home?pageNum=1'+${pageInfo.pages}" th:if="${pageInfo.hasNextPage==true}">尾页</a>-->
<!--    </div>-->


  <div style="top: 97%;left:90%;height: 5%;width:10%;position: fixed;border: 2px solid #8ff38f;border-radius: 5px;text-align: center">
    <span id="count" style="font-size: 15px;color: #989393" th:text="'共'+${session.File_Amount}+'个文件,'+${session.Folder_Amount}+'个文件夹'"></span>
  </div>


  </div>

</div>


<!--下面为黑夜模式对元素属性的控制-->
<script type="text/javascript">

  //-----↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓viewer.js图片浏览器
  function view_image(file_name,user_name)
  {
    //使用虚拟路径打开文件（web的安全性限制）
    var image = new Image();
    image.src = '/rootFolder/'+user_name+'/File/'+file_name;
    // console.log("加载图片"+image.src );
    var viewer = new Viewer(image, {
      hidden: function () {
        viewer.destroy();
      },
    });
    // image.click();
    viewer.show();
  }
  //-----↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑viewer.js图片浏览器


  function move_to_recycle_bin(file_path,file_name,suffix,file_size,create_time)
  {
    var url=window.location.href;
    $.ajax(
            {
              type:"GET",
              url:"move_to_recycle_bin?file_path=" + file_path+"&file_name="+file_name+"&suffix="+suffix+"&file_size="+file_size+"&create_time="+create_time,
              dataType:"text",
              success: function (data)
              {
                window.location.href=url;////用ajax后端无法跳转页面，必须用ajax跳转
                // window.location.href='/home';////////////接收到的信息表示账户信息是正确的，则跳转页面,用ajax后端无法跳转页面，必须用ajax跳转
              }
            }
    )
  }


  $('.button-label').click(function () {
    if($('#toggle-button').prop('cheked'))//这个表示黑暗模式关闭
    {

      $.cookie('whitemode','false');

      $('#content').css("background-image","url()");
      $('#content').css("background-color","#1c1b1b");
      $('.web-body').css("background-color","#1c1b1b");////滚动条背景色需从白色设置为主题色

      $('.table-td').css("color","#989393");
      $('.file_size_td').css("color","#989393");

      $('.image-td').css("color","#569838");

      $('#count').css("color","#989393");



      //顶栏
      $('#topbar').css("background-image","url()");
      $('#topbar').css("background-color","#1c1b1b")


      $('.file_icon').css("color","#58dc0f")
      $('.folder_icon').css("background","linear-gradient(to bottom right, #6f36be, #5be57a)")



      $('#sidebar').css("background-image","url()");
      $('#sidebar').css("background-color","#262626")



      $('#sidebar header').css("background-image","url()");
      $('#sidebar header').css("background-color","#262626")



      $('#toggle-button').prop("cheked",false);//必须要用这个设置选中状态，否则第二遍开关按钮会不起作用

    }
    else ///这个表示黑暗模式开启
    {
      $.cookie('whitemode','true');
      $('.table-td').css("color","black");
      $('.file_size_td').css("color","black");
      $('.image-td').css("color","#59b730");
      $('#count').css("color","black");

      //顶栏
      // $('#topbar').css("background-color","#ffffff");
      $('#topbar').css("background-image","url(White-Paper-Texture-Background-520x390.webp)");

      // $('#sidebar').css("background-color","#fdfdfd");
      $('#sidebar').css("background-image","url(White-Paper-Texture-Background-520x390.webp)");

      $('#viewport').css("background-image","url(White-Paper-Texture-Background-520x390.webp)");

      // $('#sidebar header').css("background-color","#ffffff");
      $('#sidebar header').css("background-image","url(White-Paper-Texture-Background-520x390.webp)");

      $('#content').css("background-image","url(White-Paper-Texture-Background-520x390.webp)");
      $('.web-body').css("background-color","#ffffff");

      $('.file_icon').css("color","#5aa531");
      $('.folder_icon').css("color","#d2cc14");


      $('#toggle-button').prop("cheked",true);///必须要用这个设置选中状态，否则第二遍开关按钮会不起作用
      // console.log(darkmode.isActivated()) // will return true

      // console.log(darkmode.isActivated()) // will return true
    }}
  );

  function DeleteFile(filename)
  {
    var url=window.location.href;
    $.ajax(
            {
              type:"GET",
              url:"delete_in_folder?fileName=" + filename,
              dataType:"text",
              success: function (data)
              {
                window.location.href=url;////用ajax后端无法跳转页面，必须用ajax跳转
                // window.location.href='/home';////////////接收到的信息表示账户信息是正确的，则跳转页面,用ajax后端无法跳转页面，必须用ajax跳转
              }
            }
    )
  }

  //-----↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓鼠标悬停时，显示对应行的操作按钮，注意实现方式
  $(".table_area").each(function ()////each才能实现每一行实现此功能
  {
    $(this).mouseover(function ()
    {
      $(this).children(".operation_button_area").show();
      $(this).children(".file_size_td").hide();

    });
  });

  $(".table_area").each(function ()
  {
    $(this).mouseout(function ()
    {
      $(this).children(".operation_button_area").hide();
      $(this).children(".file_size_td").show();
    });
  });
  //-----↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑



  $('#upload-button').click(function ()/////important这个为上传文件的ajax方法，用ajax只能ajax进行页面跳转，后端无效
  {
    // var formData = new FormData();
    //   formData.append("file", $("#select-file")[0].files[0]);
    //   var formData=new FormData($("#select-file-form"[0]));

    var formData = new FormData();
    var file=$('#select-file')[0].files;
    for(var i=0;i<file.length;i++)
    {
      formData.append("file",file[i]);
    }

    var url=window.location.href;

    console.log(formData);
    $.ajax({
      type: "POST",
      url: '/upload',
      data: formData,
      processData: false,
      contentType: false,
      success: function (data)
      {
        // var num=$('#get_cunrrent_pagenum').val();
        // '/home?pageNum='+num
        window.location.href=url;////用ajax后端无法跳转页面，必须用ajax跳转

      }
    })
  });

  $('#count').click(function ()
          {
            $.session.set('back_to_previous_path',true);
          }
  );


  function enter_folder(folder_name)
  {
    console.log("path");
    $.session.set('next_folder',folder_name);
    window.location.href="/folder?folder_name="+folder_name;
  }

  $(document).ready(function ()
  {
    //-----↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓页面加载后隐藏操作按钮
    $(".operation_button_area").hide();
    //-----↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑


    if($.cookie('whitemode')=='true')
    {
      //  console.log(window.location.href);
      $('.circle').addClass('disable_transition');
      $('.web-body').addClass('disable_transition');
      $('#sidebar').addClass('disable_transition');
      $('#sidebar header').addClass('disable_transition');

      $('.button-label').click();
      $('.web-body').removeClass('disable_transition');
      $('#sidebar').removeClass('disable_transition');
      $('#sidebar header').removeClass('disable_transition');
      $('.circle').removeClass('disable_transition');
    }


  });

  //function load(){}
  function getUrlParam(name)
  {
    var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
    var r = window.location.search.substr(1).match(reg);  //匹配目标参数
    if (r!=null) return unescape(r[2]); return null; //返回参数值
  }

  //
  // function iEsc(){ return false; }
  // function iRec(){ return true; }
  // function DisableKeys() {
  //   if(event.ctrlKey || event.shiftKey || event.altKey)  {
  //     window.event.returnValue=false;
  //     iEsc();}
  // }
  // document.ondragstart=iEsc;
  // document.onkeydown=DisableKeys;
  // document.oncontextmenu=iEsc;
  // if (typeof document.onselectstart !="undefined")
  //   document.onselectstart=iEsc;
  // else{//qsyz.net
  //   document.onmousedown=iEsc;
  //   document.onmouseup=iRec;
  // }
  // function DisableRightClick(www_qsyz_net){
  //   if (window.Event){
  //     if (www_qsyz_net.which == 2 || www_qsyz_net.which == 3)
  //       iEsc();}
  //   else
  //   if (event.button == 2 || event.button == 3){
  //     event.cancelBubble = true
  //     event.returnValue = false;
  //     iEsc();}
  // }

</script>

</body>
</html>